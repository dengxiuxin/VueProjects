var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);r.prototype=e.prototype,t.prototype=new r},Data=function(){function t(){}return t.getRectWidth=function(){return 0==t._rectWidth&&(t._rectWidth=this.getStageWidth()/4),t._rectWidth},t.getRectRow=function(){return 0==t._rectRow&&(t._rectRow=Math.ceil(this.getStageHeight()/t.getRectWidth())+1),t._rectRow},t.getStageHeight=function(){return egret.MainContext.instance.stage.stageHeight},t.getStageWidth=function(){return egret.MainContext.instance.stage.stageWidth},t._rectWidth=0,t.score=0,t._rectRow=0,t}();__reflect(Data.prototype,"Data");var Game=function(){function t(t){this._root=t,this.createGroupRect(),this.createTimer(),this.startGame()}return t.prototype.createGroupRect=function(){this._rectRoot=new egret.Sprite,this._root.addChild(this._rectRoot),this._rectGroups=[],this._row=Data.getRectRow();for(var t,e=0;e<this._row;e++)t=new GroupRect,t.addEventListener("gameOver",this.gameOver,this),t.addEventListener("clickRight",this.nextRow,this),this._rectGroups.push(t),t.y=Data.getRectWidth()*e,this._rectRoot.addChild(t);this._rectRoot.y=Data.getStageHeight()-this._rectRoot.height},t.prototype.nextRow=function(){for(var t=0;t<this._row;t++)this._rectGroups[t].move();Data.score++},t.prototype.gameOver=function(){this._timerPanel.stop(),this.gameOverPanel||(this.gameOverPanel=new GameOverPanel,this.gameOverPanel.addEventListener("startGame",this.startGame,this)),this._root.addChild(this.gameOverPanel)},t.prototype.createTimer=function(){this._timerPanel=new TimerPanel,this._timerPanel.addEventListener("gameOver",this.gameOver,this),this._root.addChild(this._timerPanel)},t.prototype.startGame=function(){Data.score=0;for(var t=0;t<this._row;t++)this._rectGroups[t].init(),this._rectGroups[t].y=Data.getRectWidth()*t,this._rectGroups[t]._currentRow=t,t!=this._row-1&&this._rectGroups[t].createBlackRect();this._timerPanel.start()},t}();__reflect(Game.prototype,"Game");var GameOverPanel=function(t){function e(){var e=t.call(this)||this;return e.draw(),e.addEventListener(egret.Event.ADDED,e.showText,e),e}return __extends(e,t),e.prototype.draw=function(){var t=egret.MainContext.instance.stage.stageWidth,e=egret.MainContext.instance.stage.stageHeight;this.graphics.beginFill(1118481,.5),this.graphics.drawRect(0,0,t,e),this.graphics.endFill(),this.txt=new egret.TextField,this.txt.width=t,this.txt.y=100,this.txt.textColor=16711680,this.txt.textAlign=egret.HorizontalAlign.CENTER,this.addChild(this.txt);var r=new egret.Sprite;r.graphics.beginFill(255),r.graphics.drawRect(0,0,200,100),r.graphics.endFill(),r.width=200,r.height=100,r.x=(t-200)/2,r.y=(e-100)/2,this.addChild(r),r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this)},e.prototype.showText=function(){this.txt.text="我点击了"+Data.score+"下"},e.prototype.startGame=function(){this.parent.removeChild(this),this.dispatchEventWith("startGame")},e}(egret.Sprite);__reflect(GameOverPanel.prototype,"GameOverPanel");var GroupRect=function(t){function e(){var e=t.call(this)||this;return e._currentRow=0,e._currentBlackRectIndex=0,e.createRects(),e}return __extends(e,t),e.prototype.createRects=function(){this._rects=[];for(var t=0;4>t;t++){var e=new Rect;this._rects.push(e),e.x=e.width*t,this.addChild(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclickRect,this)}},e.prototype.onclickRect=function(t){t.target.onRectClick(),t.target.type==RectType.NONCLICKABLE||this._currentRow!=Data.getRectRow()-2?this.dispatchEventWith("gameOver"):this.dispatchEventWith("clickRight")},e.prototype.createBlackRect=function(){this.init();var t=Math.random();t>0&&.25>=t?this._currentBlackRectIndex=0:t>.26&&.5>=t?this._currentBlackRectIndex=1:t>.5&&.75>=t?this._currentBlackRectIndex=2:t>.75&&1>=t&&(this._currentBlackRectIndex=3),this._rects[this._currentBlackRectIndex].type=RectType.CLICKABLE},e.prototype.init=function(){for(var t=0;4>t;t++)this._rects[t].type=RectType.NONCLICKABLE},e.prototype.move=function(){this._currentRow++,this._currentRow==Data.getRectRow()&&(this._currentRow=0,this.createBlackRect()),this.y=this._currentRow*Data.getRectWidth()},e}(egret.Sprite);__reflect(GroupRect.prototype,"GroupRect");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addStage,e),e}return __extends(e,t),e.prototype.addStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addStage,this);new Game(this)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Rect=function(t){function e(){var e=t.call(this)||this;return e._colors=[0,16777215,16711680,255],e._currentColor=1,e._type=RectType.NONCLICKABLE,e.touchEnabled=!0,e.darw(),e}return __extends(e,t),e.prototype.darw=function(){this.width=Data.getRectWidth(),this.height=Data.getRectWidth(),this.graphics.lineStyle(1,0),this.graphics.beginFill(this._colors[this._currentColor]),this.graphics.drawRect(0,0,Data.getRectWidth(),Data.getRectWidth()),this.graphics.endFill()},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t,this._type==RectType.CLICKABLE?this._currentColor=0:this._currentColor=1,this.darw()},enumerable:!0,configurable:!0}),e.prototype.onRectClick=function(){this._type==RectType.CLICKABLE?this._currentColor=3:this._currentColor=2,this.darw()},e}(egret.Sprite);__reflect(Rect.prototype,"Rect");var RectType=function(){function t(){}return t.CLICKABLE="clickable",t.NONCLICKABLE="nonclickable",t}();__reflect(RectType.prototype,"RectType");var TimerPanel=function(t){function e(){var e=t.call(this)||this;return e._num=20,e._timers=20,e.draw(),e.createTimer(),e}return __extends(e,t),e.prototype.draw=function(){this.text=new egret.TextField,this.text.width=egret.MainContext.instance.stage.stageWidth,this.text.y=100,this.text.textColor=16711680,this.text.textAlign=egret.HorizontalAlign.CENTER,this.text.text="20'00'",this.addChild(this.text)},e.prototype.createTimer=function(){this._timer=new egret.Timer(1e3,this._num),this._timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this._timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerCom,this)},e.prototype.onTimer=function(){this._timers-=1,this.text.text=this._timers+"'00''"},e.prototype.onTimerCom=function(){this.text.text="00'00''",this.dispatchEventWith("gameOver")},e.prototype.start=function(){this.text.text="20'00'",this._timers=20,this._timer.reset(),this._timer.start()},e.prototype.stop=function(){this._timer.stop()},e}(egret.Sprite);__reflect(TimerPanel.prototype,"TimerPanel");